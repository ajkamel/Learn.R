// This is a manifest file that'll be compiled into application.js, which will include all the files
// listed below.
//
// Any JavaScript/Coffee file within this directory, lib/assets/javascripts, vendor/assets/javascripts,
// or vendor/assets/javascripts of plugins, if any, can be referenced here using a relative path.
//
// It's not advisable to add code directly here, but if you do, it'll appear at the bottom of the
// compiled file.
//
// Read Sprockets README (https://github.com/sstephenson/sprockets#sprockets-directives) for details
// about supported directives.
//
//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require_tree .

var stage;
var birdImage = new Image();
var bird;
var backgroundImage = new Image();
var background;
var startRow;
var startCol;
var solutionRow;
var solutionCol;
var xstep = 127;
var ystep = 74;
var pixelConverter = {x0: 33, y0: 10};

// var commandConverter = {'moveUp();': moveImageOneUnitUp,
//                         'moveDown();': moveImageOneUnitDown,
//                         'moveLeft();': moveImageOneUnitLeft,
//                         'moveRight();': moveImageOneUnitRight};

function setCoords() {
  var lessonID = $('.lesson-id').eq(0).data().id;
  $.ajax({
    url: ('/code_lessons/' + lessonID),
    method: 'get',
    dataType: 'json',
  }).done(function(lesson){
    startRow    = lesson.start_row;
    console.log(startRow);
    startCol    = lesson.start_col;
    console.log(startCol);
    solutionRow = lesson.solution_row;
    console.log(solutionRow);
    solutionCol = lesson.solution_col;
    console.log(solutionCol);
  });
}

function init() {
  stage = new createjs.Stage(document.getElementById("lessoncanvas"));
  birdImage.src = "<%= asset_path 'bird.png' %>";
  birdImage.name = 'bird';
  backgroundImage.src = "<%= asset_path 'grid.png' %>";
  backgroundImage.name = 'background';
  backgroundImage.onload = loadGraphics;
}

function loadGraphics() {
  background = new createjs.Bitmap(backgroundImage);
  stage.addChild(background);
  bird = new createjs.Bitmap(birdImage);
  bird.x = 33;
  bird.y = 10;
  stage.addChild(bird);
  stage.update();
}

function throwError() {
  $('.errors').empty();
  $('.errors').append('<p>Oops looks like something went wrong</p>');
}

function ready() {
  if ($('#code_lessons_page')[0] !== undefined) {
    setCoords();
    init();
  }
}

$(document).ready(ready);
$(document).on('page:load', ready);
